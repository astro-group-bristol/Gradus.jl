<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Line profiles · Gradus.jl Documentation</title><meta name="title" content="Line profiles · Gradus.jl Documentation"/><meta property="og:title" content="Line profiles · Gradus.jl Documentation"/><meta property="twitter:title" content="Line profiles · Gradus.jl Documentation"/><meta name="description" content="Documentation for Gradus.jl Documentation."/><meta property="og:description" content="Documentation for Gradus.jl Documentation."/><meta property="twitter:description" content="Documentation for Gradus.jl Documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Gradus.jl Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Gradus.jl Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting-started/">Getting started</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><span class="tocitem">Reference &amp; walkthroughs</span><ul><li><a class="tocitem" href="../metrics/">Catalogue of metrics</a></li><li><a class="tocitem" href="../accretion-geometry/">Accretion geometry</a></li><li><a class="tocitem" href="../problems-and-solvers/">Problems and solvers</a></li><li><a class="tocitem" href="../point-functions/">Point functions</a></li><li><a class="tocitem" href="../emissivity/">Disc emissivity</a></li><li class="is-active"><a class="tocitem" href>Line profiles</a></li></ul></li><li><span class="tocitem">Geodesics and integration</span><ul><li><a class="tocitem" href="../custom-metrics/">Implementing new metrics</a></li><li><a class="tocitem" href="../geodesic-integration/">Geodesic integration</a></li><li><a class="tocitem" href="../parallelism/">Parallelism and ensembles</a></li><li><a class="tocitem" href="../special-radii/">Special radii</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../api-documentation/Gradus/">Gradus</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference &amp; walkthroughs</a></li><li class="is-active"><a href>Line profiles</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Line profiles</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/astro-group-bristol/Gradus.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/astro-group-bristol/Gradus.jl/blob/main/docs/src/lineprofiles.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Line-profiles"><a class="docs-heading-anchor" href="#Line-profiles">Line profiles</a><a id="Line-profiles-1"></a><a class="docs-heading-anchor-permalink" href="#Line-profiles" title="Permalink"></a></h1><p>Line profiles are kernels that represent the blurring of spectral lines from e.g. an accretion disc around a black hole. They show how the flux is smeared over a range of energies relative to the rest energy due to relativistic effects and Doppler shifts.</p><p>Gradus.jl has various methods for calculating line profiles (see <a href="../geodesic-integration/#Methods"><code>Methods</code></a>). Here we will explore how to compute line profiles with Gradus using the <a href="../geodesic-integration/#Gradus.BinningMethod"><code>BinningMethod</code></a> and the <a href="../geodesic-integration/#Gradus.TransferFunctionMethod"><code>TransferFunctionMethod</code></a>.</p><p>As with any Gradus.jl simulation, we start by picking the basic components of our model:</p><pre><code class="language-julia hljs">using Gradus

m = KerrMetric(M = 1.0, a = 0.998)
# an infinite thin disc in the equatorial plane
d = ThinDisc(0.0, Inf)
x = SVector(0.0, 10_000.0, deg2rad(60), 0.0)</code></pre><p>We can compute a line profile directly using the <a href="#Gradus.lineprofile"><code>lineprofile</code></a> method:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Gradus.lineprofile" href="#Gradus.lineprofile"><code>Gradus.lineprofile</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lineprofile(m::AbstractMetric, x::SVector, d::AbstractAccretionGeometry; kwargs...)
lineprofile(
    m::AbstractMetric, 
    x::SVector, 
    d::AbstractAccretionDisc, 
    profile::AbstractDiscProfile; 
    kwargs...
)</code></pre><p>Compute a line profile for a given set of model components. Returns both the grid and flux.</p><p>The dispatch that includes a <code>profile</code> can be used with an <a href="@ref"><code>AbstractDiscProfile</code></a>, conventionally calculated by a coronal model.</p><p>If no profile is specified, the emissivity is assumed to be a power-law <span>$\varepsilon(r) = r^{-3}$</span>.</p><p>This function accepts a number of keyword arguments depending on method used to compute the line profile. Common arguments with their defaults are:</p><ul><li><code>bins = collect(range(0.1, 1.5, 180))</code>: the (energy) bins used as the domain of the line profile.</li><li><code>method = TransferFunctionMethod()</code>: used to select which method to use when  computing the line profile. Alternatives include <a href="../geodesic-integration/#Gradus.BinningMethod"><code>BinningMethod</code></a>.</li></ul><p>The <a href="../geodesic-integration/#Gradus.TransferFunctionMethod"><code>TransferFunctionMethod</code></a> dispatch additionally accepts the following keyword arguments:</p><ul><li><code>minrₑ = isco(m)</code>: the innermost transfer function radius to compute / inner  radius of line profile integration.</li><li><code>maxrₑ = 50</code>: the outermost transfer function radius to compute / outer radius  of line profile integration.</li><li><code>numrₑ = 100</code>: the number of transfer functions to calculate.</li><li><code>verbose = false</code>: show a progress bar.</li><li><code>h = 2e-8</code>: an integration padding value to avoid numerical instabilities. See  Dauser et al., 2010 for details.</li><li><code>Nr = 1000</code>: the number of radial steps used to interpolate between transfer  function branches when integrating.</li></ul><p>The <a href="../geodesic-integration/#Gradus.BinningMethod"><code>BinningMethod</code></a> dispatch additionally accepts the following keyword arguments:</p><ul><li><code>λ_max = 2 * x[2]</code>: the maximum integration time (affine parameter).</li><li><code>redshift_pf = ConstPointFunctions.redshift(m, x)</code>: the function used to  compute redshift values.</li><li><code>verbose = false</code>: show a progress bar.</li><li><code>minrₑ = isco(m)</code>:` the inner radius of the line profile.</li><li><code>maxrₑ = T(50)</code>:` the outer radius of the line profile.</li><li><code>plane = PolarPlane(GeometricGrid(); Nr = 450, Nθ = 1300, r_max = 5maxrₑ)</code>:  the image plane used in the calculation.</li></ul><p>All other keyword arguments are passed to <a href="../api-documentation/Gradus/#Gradus.tracegeodesics"><code>tracegeodesics</code></a>.</p><p>There is an additional dispatch that does not accept <code>bins</code> as a keyword argument:</p><pre><code class="nohighlight hljs">lineprofile(
    bins,
    ε::Function,
    m::AbstractMetric,
    u,
    d::AbstractAccretionGeometry;
    kwargs...
)</code></pre><p>This dispatch is special as it be used to pass any arbitrary function to act as the emissivity profile of the disc.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/astro-group-bristol/Gradus.jl/blob/512ddf3421d56de910108cccd5696c08776f3d4b/src/line-profiles.jl#L19-L84">source</a></section></article><p>We can invoke this directly </p><pre><code class="language-julia hljs">bins, flux = lineprofile(m, x, d)</code></pre><p>If a custom (enregy) bins is desired, it can be passed using the keyword arguments. We can plot these vectors directly:</p><pre><code class="language-julia hljs">using Plots
plot(bins, flux; xlabel = &quot;g&quot;, ylabel = &quot;flux&quot;)</code></pre><p><img src="../example-figures/lp.simple-lineprofile.svg" alt/></p><p>To pass a custom emissivity function, we can use a different dispatch that takes the <code>bins</code> and the emissivity function as the first argument. Here is a shallower power-law, reusing the same bins:</p><pre><code class="language-julia hljs">emissivity(r) = r^-2
bins, flux = lineprofile(bins, emissivity, m, x, d)
plot!(bins, flux)</code></pre><p><img src="../example-figures/lp.shallower-emissivity.svg" alt/></p><p>To use the emissivity calcualted via an <a href="@ref"><code>AbstractDiscProfile</code></a> from a coronal model, we can do something like</p><pre><code class="language-julia hljs">model = LampPostModel(h = 10.0)
profile = emissivity_profile(m, d, model)
bins, flux = lineprofile(m, x, d, profile; bins = bins)
plot!(bins, flux)</code></pre><p><img src="../example-figures/lp.with-binning.svg" alt/></p><p>We can at any point switch to the <a href="../geodesic-integration/#Gradus.BinningMethod"><code>BinningMethod</code></a> dispatches, which have largely the same functions calls. These methods take significantly longer to execute, and often give slightly lower resolution, however are much more flexible in the underlying assumptions of the model:</p><pre><code class="language-julia hljs">bins, flux = lineprofile(m, x, d, profile; bins = bins, method = BinningMethod())
plot!(bins, flux)</code></pre><p><img src="../example-figures/lp.lamp-post-emissivity.svg" alt/></p><p>The defaults have been chosen to balance accuracy and speed. The above <a href="../geodesic-integration/#Gradus.TransferFunctionMethod"><code>TransferFunctionMethod</code></a> calculations only take a handful of seconds to compute from scratch. If all we are changing are properties of the disc, we do not necessarily need to recompute the transfer functions, and can make use of caches instead. Here is an example recipe using the <a href="@ref"><code>transferfunctions</code></a> utility:</p><pre><code class="language-julia hljs">tfs = transferfunctions(m, x, d)

f1 = integrate_lineprofile(r -&gt; r^-3, tfs, bins)
f2 = integrate_lineprofile(profile, tfs, bins)

plot(bins, f1)
plot!(bins, f2)</code></pre><p><img src="../example-figures/lp.pre-computed-tfs.svg" alt/></p><p>Similar pre-computation can be done with the binning method, however there are currently no utility functions available in the same way as with the transfer functions.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Gradus.integrate_lineprofile" href="#Gradus.integrate_lineprofile"><code>Gradus.integrate_lineprofile</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">integrate_lineprofile(
    prof::AbstractDiscProfile, 
    transfer_functions, 
    g_grid;
    kwargs...
)
integrate_lineprofile(
    emssivity::Function,
    transfer_functions, 
    g_grid;
    kwargs...
)</code></pre><p>Integrate a set of <a href="@ref"><code>InterpolatingTransferBranches</code></a> (calculated using <a href="@ref"><code>transferfunctions</code></a>) with either an <a href="@ref"><code>AbstractDiscProfile</code></a> or function representing the emissivity profile of the disc.</p><p>The emissivity function must be of the form <code>r -&gt; f(r)::tyepof(r)</code>, i.e. represent the emissivty as a function of only radius, returning a single value for each ring.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/astro-group-bristol/Gradus.jl/blob/512ddf3421d56de910108cccd5696c08776f3d4b/src/transfer-functions/integration.jl#L205-L226">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../emissivity/">« Disc emissivity</a><a class="docs-footer-nextpage" href="../custom-metrics/">Implementing new metrics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 6 February 2025 16:57">Thursday 6 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
